package com.thinkmorestupidless.betfair.streams.impl

import com.thinkmorestupidless.betfair.streams.domain.RunnerChange
import com.thinkmorestupidless.betfair.streams.impl.JsonCodecs.runnerChangeCodec
import com.thinkmorestupidless.betfair.streams.impl.JsonCodecsSpec.RunnerChangeWithSpfJsonStr
import io.circe.parser._
import org.scalatest.matchers.should.Matchers
import org.scalatest.wordspec.AnyWordSpecLike
import io.circe._
import io.circe.syntax._

final class JsonCodecsSpec extends AnyWordSpecLike with Matchers {

  "RunnerChange" should {
    "be readable from Json" in {
      val json = parse(RunnerChangeWithSpfJsonStr).getOrElse(fail("failed to parse RunnerChange json string"))
      json.as[RunnerChange].getOrElse(fail("failed to decode json to RunnerChange"))
    }
  }
}

object JsonCodecsSpec {

  val RunnerChangeNoSpfJsonStr =
    """{"atb":[[1.46,116.01],[1.04,6961.36],[1.05,5221.02],[1.06,4350.85],[1.02,13054.56],[1.03,8701.71],[1.45,90.23],[1.01,26264.12],[1.5,5.04],[1.48,0.96]],"atl":[[1.54,97.75],[1.51,4.42]],"trd":[[1.5,13.8],[1.49,3.04],[1.48,0.92],[1.36,0.58],[2.46,0.01]],"batb":[[8,1.01,26264.12],[7,1.02,13054.56],[6,1.03,8701.71],[5,1.04,6961.36],[4,1.05,5221.02],[3,1.06,4350.85],[2,1.45,90.23],[1,1.46,116.97],[0,1.5,5.04]],"batl":[[1,1.54,97.75],[0,1.51,4.42]],"bdatb":[[3,1.44,117.54],[4,1.43,64.76],[1,1.46,125.22],[2,1.45,182.65],[5,1.06,4350.85],[6,1.05,5221.02],[7,1.04,6961.36],[8,1.03,8701.71],[9,1.02,13054.56],[0,1.5,5.04]],"bdatl":[[1,1.54,97.75],[2,1.55,3.6],[3,1.56,4.08],[4,1.57,206.3],[5,1.58,7.43],[6,980,0.26],[0,1.51,4.42],[7,0,0],[8,0,0],[9,0,0]],"spn":1.51,"spf":"NaN","ltp":1.5,"tv":18.35,"id":78864}"""

  val RunnerChangeWithSpfJsonStr =
    """{"atb":[[1.79,88.26],[1.78,501.37],[1.81,41.43],[1.8,133.17],[1.04,8701.71],[1.05,7001.36],[1.06,4350.85],[1.02,14894.9],[1.03,10442.05],[1.01,28205.33],[1.73,391.58],[1.1,20],[1.7,1.86],[1.21,9.5],[1.43,4.65]],"atl":[[1.82,482.7],[1.86,672.95],[1.9,90.87],[1.83,1201.36],[1.87,201.96],[1.88,1.19],[1.89,1],[2.02,0.81],[1.91,1],[1.92,3.58],[980,0.16],[1.93,1],[1.85,1],[1.84,39],[2.3,2]],"trd":[[1.82,1646.52],[1.86,423.2],[1.88,469.51],[1.81,742.52],[1.8,113.16],[1.93,30.91],[1.87,698.61],[1.94,60.41],[1.85,841.46],[1.84,1443.74],[1.89,452.34],[1.83,1126.09],[1.91,262.34],[1.9,978.35],[1.92,10]],"spl":[[1.01,4.65]],"batb":[[2,1.79,88.26],[3,1.78,501.37],[1,1.8,133.17],[0,1.81,41.43],[9,1.06,4350.85],[8,1.1,20],[7,1.21,9.5],[6,1.43,4.65],[5,1.7,1.86],[4,1.73,391.58]],"batl":[[0,1.82,482.7],[8,1.9,90.87],[4,1.86,672.95],[1,1.83,1201.36],[6,1.88,1.19],[5,1.87,201.96],[7,1.89,1],[9,1.91,1],[3,1.85,1],[2,1.84,39]],"bdatb":[[6,1.75,364.19],[3,1.78,1239.03],[5,1.76,223.83],[7,1.74,88.66],[8,1.73,448.59],[9,1.72,36.13],[2,1.79,647.61],[1,1.8,340.67],[0,1.81,41.43],[4,1.77,177.95]],"bdatl":[[6,1.88,314.54],[7,1.89,52.15],[9,1.91,327.42],[8,1.9,543.22],[3,1.85,1],[2,1.84,199.95],[5,1.87,418.42],[0,1.82,482.7],[1,1.83,1262.2],[4,1.86,812.64]],"spn":1.81,"spf":1,"ltp":1.82,"tv":9299.16,"id":1096}"""
}
